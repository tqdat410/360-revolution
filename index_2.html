<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=no"
    />
    <title>C√°ch M·∫°ng C√¥ng Nghi·ªáp - Tr·∫£i Nghi·ªám 360¬∞</title>
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <style>
      #infoPanel {
        position: fixed;
        top: 20px;
        right: 20px;
        width: 300px;
        max-height: 400px;
        background: rgba(0, 0, 0, 0.9);
        color: white;
        padding: 20px;
        border-radius: 10px;
        font-family: Arial, sans-serif;
        display: none;
        z-index: 1000;
        overflow-y: auto;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      }
      #infoPanel h3 {
        margin-top: 0;
        color: #4caf50;
        font-size: 18px;
      }
      #infoPanel p {
        font-size: 14px;
        line-height: 1.5;
      }
      #closeBtn {
        position: absolute;
        top: 10px;
        right: 15px;
        background: none;
        border: none;
        color: white;
        font-size: 24px;
        cursor: pointer;
        padding: 5px;
      }
      #instructions {
        position: fixed;
        bottom: 20px;
        left: 20px;
        background: rgba(0, 0, 0, 0.8);
        color: white;
        padding: 10px 15px;
        border-radius: 20px;
        font-family: Arial, sans-serif;
        font-size: 14px;
        z-index: 1000;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
      }

      /* Responsive cho mobile */
      @media screen and (max-width: 768px) {
        #infoPanel {
          top: 10px;
          right: 10px;
          left: 10px;
          width: auto;
          max-height: 50vh;
          padding: 15px;
        }
        #infoPanel h3 {
          font-size: 16px;
          margin-bottom: 10px;
        }
        #infoPanel p {
          font-size: 13px;
          line-height: 1.4;
        }
        #closeBtn {
          font-size: 20px;
          top: 8px;
          right: 12px;
        }
        #instructions {
          bottom: 15px;
          left: 15px;
          right: 15px;
          text-align: center;
          padding: 8px 12px;
          font-size: 12px;
        }
      }

      @media screen and (max-width: 480px) {
        #infoPanel {
          top: 5px;
          right: 5px;
          left: 5px;
          max-height: 45vh;
          padding: 12px;
        }
        #infoPanel h3 {
          font-size: 15px;
        }
        #infoPanel p {
          font-size: 12px;
        }
        #instructions {
          bottom: 10px;
          left: 10px;
          right: 10px;
          padding: 10px 10px;
          font-size: 11px;
        }
      }

      /* Responsive cho m√†n h√¨nh ƒëi·ªán tho·∫°i n·∫±m ngang */
      @media screen and (max-height: 500px) and (orientation: landscape) {
        #infoPanel {
          top: 5px;
          right: 5px;
          left: 5px;
          width: auto;
          max-height: 70vh;
          padding: 8px 12px;
          font-size: 11px;
        }
        #infoPanel h3 {
          font-size: 13px;
          margin-top: 0;
          margin-bottom: 6px;
        }
        #infoPanel p {
          font-size: 10px;
          line-height: 1.3;
          margin-bottom: 0;
        }
        #closeBtn {
          font-size: 16px;
          top: 4px;
          right: 8px;
          padding: 2px;
        }
        #instructions {
          bottom: 8px;
          left: 8px;
          right: 8px;
          padding: 6px 8px;
          font-size: 10px;
        }
      }

      /* Zoom Controls */
      #zoomControls {
        position: fixed;
        bottom: 20px;
        right: 20px;
        display: flex;
        flex-direction: column;
        gap: 10px;
        z-index: 1000;
      }

      #zoomControls button {
        width: 50px;
        height: 50px;
        border: none;
        border-radius: 50%;
        background: rgba(0, 0, 0, 0.8);
        color: white;
        font-size: 18px;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
      }

      #zoomControls button:hover {
        background: rgba(0, 0, 0, 0.9);
        transform: scale(1.1);
      }

      #zoomControls button:active {
        transform: scale(0.95);
      }

      @media screen and (max-width: 768px) {
        #zoomControls {
          bottom: 70px;
          right: 15px;
        }
        #zoomControls button {
          width: 45px;
          height: 45px;
          font-size: 16px;
        }
      }

      /* Page Switch Button */
      #pageSwitch {
        position: fixed;
        top: 20px;
        left: 20px;
        z-index: 1000;
      }

      #pageSwitch button {
        background: rgba(76, 175, 80, 0.9);
        color: white;
        border: none;
        padding: 12px 20px;
        border-radius: 25px;
        font-family: Arial, sans-serif;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        backdrop-filter: blur(10px);
      }

      #pageSwitch button:hover {
        background: rgba(76, 175, 80, 1);
        transform: translateY(-2px);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
      }

      #pageSwitch button:active {
        transform: translateY(0);
      }

      @media screen and (max-width: 768px) {
        #pageSwitch {
          top: 15px;
          left: 15px;
        }
        #pageSwitch button {
          padding: 10px 16px;
          font-size: 12px;
        }
      }

      @media screen and (max-width: 480px) {
        #pageSwitch {
          top: 10px;
          left: 10px;
        }
        #pageSwitch button {
          padding: 8px 12px;
          font-size: 11px;
        }
      }
    </style>
  </head>
  <body>
    <!-- Panel th√¥ng tin -->
    <div id="infoPanel">
      <button id="closeBtn" onclick="closeInfo()">&times;</button>
      <div id="infoContent"></div>
    </div>

    <!-- H∆∞·ªõng d·∫´n -->
    <div id="instructions">üí° ·∫§n v√†o c√°c ch·∫•m tr√≤n ƒë·ªÉ xem th√¥ng tin</div>

    <!-- N√∫t chuy·ªÉn ƒë·ªïi trang -->
    <div id="pageSwitch">
      <button onclick="switchToMainPage()" title="Chuy·ªÉn sang trang ch√≠nh">
        üñºÔ∏è Chuy·ªÉn C·∫£nh
      </button>
    </div>

    <!-- Zoom Controls cho mobile (ƒë√£ ·∫©n) -->
    <div id="zoomControls" style="display: none">
      <button id="zoomIn">üîç+</button>
      <button id="zoomOut">üîç-</button>
      <button id="zoomReset">‚Üª</button>
    </div>

    <a-scene>
      <!-- ·∫¢nh 360¬∞ ƒë·∫∑t l√†m skybox -->
      <a-sky src="final_3.png" rotation="0 -180 0"></a-sky>

      <!-- Giai ƒëo·∫°n 1: Th·ªùi k·ª≥ S∆° khai (0¬∞) -->
      <a-sphere
        id="hotspot1-1"
        position="0 5.5 -15"
        radius="0.5"
        color="#FF6B6B"
        opacity="0.8"
        animation="property: rotation; to: 0 360 0; loop: true; dur: 3000"
        class="hotspot clickable"
        data-info='{"title": "Th·ªùi K·ª≥ S∆° Khai - Tri·∫øt H·ªçc", "content": "1. Tri·∫øt h·ªçc giai ƒëo·∫°n n√†y v·∫´n mang t√≠nh t√¥n gi√°o v√† th·∫ßn h·ªçc (Kit√¥ gi√°o ·ªü ch√¢u √Çu, Nho gi√°o ·ªü ph∆∞∆°ng ƒê√¥ng).<br><br>2. Tri·∫øt h·ªçc Hy L·∫°p ‚Äì La M√£ c·ªï ƒë·∫°i (Plato, Aristotle) v·∫´n c√≤n ·∫£nh h∆∞·ªüng.<br><br>3. Ch·ªß y·∫øu b√†n v·ªÅ t√¥n gi√°o, ƒë·∫°o ƒë·ª©c, tr·∫≠t t·ª± x√£ h·ªôi.<br><br>4. Con ng∆∞·ªùi s·ªëng h√≤a h·ª£p v·ªõi thi√™n nhi√™n, tin v√†o s·ªë ph·∫≠n v√† th·∫ßn linh."}'
      ></a-sphere>

      <a-sphere
        id="hotspot1-2"
        position="0 -2 -15"
        radius="0.5"
        color="#4ECDC4"
        opacity="0.8"
        animation="property: rotation; to: 0 360 0; loop: true; dur: 3000"
        class="hotspot clickable"
        data-info='{"title": "Th·ªùi K·ª≥ S∆° Khai - S·∫£n Xu·∫•t", "content": "1. N·ªÅn s·∫£n xu·∫•t ch·ªß y·∫øu d·ª±a v√†o n√¥ng nghi·ªáp v√† th·ªß c√¥ng nghi·ªáp.<br><br>2. X√£ h·ªôi theo m√¥ h√¨nh phong ki·∫øn, t·ª± cung t·ª± c·∫•p, s·∫£n xu·∫•t quy m√¥ nh·ªè.<br><br>3. C√¥ng c·ª• lao ƒë·ªông c√≤n th√¥ s∆° (cu·ªëc, c√†y, r√¨u, b√∫a)."}'
      ></a-sphere>

      <!-- Camera v·ªõi cursor ƒë·ªÉ click v√† zoom -->
      <a-entity
        camera
        look-controls="enabled: true; minVerticalLook: -60; maxVerticalLook: 60; touchEnabled: true; magicWindowTrackingEnabled: true"
        wasd-controls="enabled: false"
        rotation="0 0 0"
        position="0 1.6 0"
        zoom-control
      >
        <a-entity
          cursor="fuse: true; fuseTimeout: 1500"
          position="0 0 -1"
          geometry="primitive: ring; radiusInner: 0.008; radiusOuter: 0.015"
          material="color: white; shader: flat"
          raycaster="objects: .clickable; far: 50"
        >
        </a-entity>
      </a-entity>
    </a-scene>

    <script>
      // ƒê·ª£i A-Frame load xong
      document.addEventListener("DOMContentLoaded", function () {
        setTimeout(function () {
          setupInteractions();
          setupMobileCamera();
        }, 1000);
      });

      function setupMobileCamera() {
        const camera = document.querySelector("[camera]");

        if (camera) {
          // Force reset camera rotation on mobile
          if (window.innerWidth <= 768) {
            // Disable device orientation initially to set fixed starting position
            camera.setAttribute("look-controls", {
              enabled: true,
              touchEnabled: true,
              mouseEnabled: true,
              pointerLockEnabled: false,
              reverseMouseDrag: false,
              reverseTouchDrag: false,
              minVerticalLook: -60,
              maxVerticalLook: 60,
              magicWindowTrackingEnabled: false, // T·∫Øt c·∫£m bi·∫øn ban ƒë·∫ßu
            });

            // Set fixed initial rotation to center
            camera.setAttribute("rotation", "0 0 0");

            // After a delay, enable device orientation tracking
            setTimeout(() => {
              camera.setAttribute("look-controls", {
                enabled: true,
                touchEnabled: true,
                mouseEnabled: true,
                pointerLockEnabled: false,
                reverseMouseDrag: false,
                reverseTouchDrag: false,
                minVerticalLook: -60,
                maxVerticalLook: 60,
                magicWindowTrackingEnabled: true, // B·∫≠t l·∫°i c·∫£m bi·∫øn sau khi ƒë√£ set v·ªã tr√≠
              });
            }, 1500);

            // Force camera position multiple times to ensure it sticks
            setTimeout(() => {
              camera.setAttribute("rotation", "0 0 0");
              if (camera.object3D) {
                camera.object3D.rotation.set(0, 0, 0);
              }
            }, 500);

            setTimeout(() => {
              camera.setAttribute("rotation", "0 0 0");
            }, 1000);
          }
        }
      }

      function setupInteractions() {
        // X·ª≠ l√Ω click v√†o hotspot
        document.querySelectorAll(".hotspot").forEach((hotspot) => {
          hotspot.addEventListener("click", function () {
            const info = JSON.parse(this.getAttribute("data-info"));
            showInfo(info.title, info.content);
          });

          // X·ª≠ l√Ω fuse (mobile - nh√¨n l√¢u v√†o ƒëi·ªÉm)
          hotspot.addEventListener("fusing", function () {
            this.setAttribute("scale", "1.3 1.3 1.3");
          });

          hotspot.addEventListener("fused", function () {
            const info = JSON.parse(this.getAttribute("data-info"));
            showInfo(info.title, info.content);
            this.setAttribute("scale", "1 1 1");
          });

          // Hi·ªáu ·ª©ng hover
          hotspot.addEventListener("mouseenter", function () {
            this.setAttribute("scale", "1.2 1.2 1.2");
          });

          hotspot.addEventListener("mouseleave", function () {
            this.setAttribute("scale", "1 1 1");
          });
        });

        // Th√™m t∆∞∆°ng t√°c click tr·ª±c ti·∫øp kh√¥ng c·∫ßn cursor
        const scene = document.querySelector("a-scene");

        // Click tr·ª±c ti·∫øp cho desktop
        scene.addEventListener("mousedown", function (event) {
          const mouseX = (event.clientX / window.innerWidth) * 2 - 1;
          const mouseY = -(event.clientY / window.innerHeight) * 2 + 1;

          const camera = document.querySelector("[camera]");
          if (camera && camera.components && camera.components.camera) {
            const raycaster = new THREE.Raycaster();
            const mouse = new THREE.Vector2(mouseX, mouseY);

            raycaster.setFromCamera(mouse, camera.components.camera.camera);

            const hotspots = [];
            document.querySelectorAll(".hotspot").forEach((hotspot) => {
              if (hotspot.object3D) {
                hotspots.push(hotspot.object3D);
                hotspot.object3D.userData.element = hotspot;
              }
            });

            const intersects = raycaster.intersectObjects(hotspots, true);

            if (intersects.length > 0) {
              let hotspotElement = intersects[0].object.userData.element;

              if (!hotspotElement && intersects[0].object.parent) {
                hotspotElement = intersects[0].object.parent.userData.element;
              }

              if (hotspotElement && hotspotElement.getAttribute("data-info")) {
                const info = JSON.parse(
                  hotspotElement.getAttribute("data-info")
                );
                showInfo(info.title, info.content);
                event.stopPropagation();
              }
            }
          }
        });

        // Touch cho mobile
        scene.addEventListener("touchstart", function (event) {
          if (event.touches.length === 1) {
            const touch = event.touches[0];
            const mouseX = (touch.clientX / window.innerWidth) * 2 - 1;
            const mouseY = -(touch.clientY / window.innerHeight) * 2 + 1;

            const camera = document.querySelector("[camera]");
            if (camera && camera.components && camera.components.camera) {
              const raycaster = new THREE.Raycaster();
              const mouse = new THREE.Vector2(mouseX, mouseY);

              raycaster.setFromCamera(mouse, camera.components.camera.camera);

              const hotspots = [];
              document.querySelectorAll(".hotspot").forEach((hotspot) => {
                if (hotspot.object3D) {
                  hotspots.push(hotspot.object3D);
                  hotspot.object3D.userData.element = hotspot;
                }
              });

              const intersects = raycaster.intersectObjects(hotspots, true);

              if (intersects.length > 0) {
                let hotspotElement = intersects[0].object.userData.element;

                if (!hotspotElement && intersects[0].object.parent) {
                  hotspotElement = intersects[0].object.parent.userData.element;
                }

                if (
                  hotspotElement &&
                  hotspotElement.getAttribute("data-info")
                ) {
                  const info = JSON.parse(
                    hotspotElement.getAttribute("data-info")
                  );
                  showInfo(info.title, info.content);
                  event.preventDefault();
                  event.stopPropagation();
                }
              }
            }
          }
        });

        // Setup zoom controls v√† t·ª± ƒë·ªông ·∫©n instructions
        setupZoomControls();

        if (window.innerWidth <= 768) {
          setTimeout(() => {
            const instructions = document.getElementById("instructions");
            if (instructions) {
              instructions.style.opacity = "0.7";
              instructions.style.transform = "scale(0.9)";
              instructions.style.transition = "all 0.3s ease";

              // ·∫®n ho√†n to√†n sau 10 gi√¢y
              setTimeout(() => {
                instructions.style.display = "none";
              }, 10000);
            }
          }, 5000);
        }

        // Listen for scene load to ensure camera is set correctly
        scene.addEventListener("loaded", () => {
          const camera = document.querySelector("[camera]");
          if (camera && window.innerWidth <= 768) {
            // Force initial rotation to center for mobile
            setTimeout(() => {
              camera.setAttribute("rotation", "0 0 0");
              if (camera.components["look-controls"]) {
                camera.components["look-controls"].pitchObject.rotation.x = 0;
                camera.components["look-controls"].yawObject.rotation.y = 0;
              }
            }, 100);
          }
        });

        console.log("Interactions setup complete!");
      }

      function showInfo(title, content) {
        const panel = document.getElementById("infoPanel");
        const infoContent = document.getElementById("infoContent");

        infoContent.innerHTML = `
          <h3>${title}</h3>
          <p>${content}</p>
        `;

        panel.style.display = "block";

        // Smooth animation
        panel.style.opacity = "0";
        panel.style.transform = "translateY(-10px)";
        setTimeout(() => {
          panel.style.opacity = "1";
          panel.style.transform = "translateY(0)";
          panel.style.transition = "opacity 0.3s ease, transform 0.3s ease";
        }, 10);

        // T·ª± ƒë·ªông ·∫©n - th·ªùi gian kh√°c nhau cho desktop v√† mobile
        const hideTime = window.innerWidth <= 768 ? 12000 : 15000;
        setTimeout(() => {
          panel.style.opacity = "0";
          panel.style.transform = "translateY(-10px)";
          setTimeout(() => {
            panel.style.display = "none";
          }, 300);
        }, hideTime);
      }

      function closeInfo() {
        const panel = document.getElementById("infoPanel");
        panel.style.opacity = "0";
        panel.style.transform = "translateY(-10px)";
        setTimeout(() => {
          panel.style.display = "none";
        }, 300);
      }

      // Zoom functionality - ch·ªâ zoom in t·ª´ v·ªã tr√≠ m·∫∑c ƒë·ªãnh
      let currentFOV = 75; // Default FOV (v·ªã tr√≠ m·∫∑c ƒë·ªãnh)
      const minFOV = 45; // Max zoom in
      const defaultFOV = 75; // V·ªã tr√≠ m·∫∑c ƒë·ªãnh

      function setupZoomControls() {
        const camera = document.querySelector("[camera]");

        // Mouse wheel zoom for desktop (ch·ªâ zoom in)
        document.addEventListener(
          "wheel",
          function (event) {
            event.preventDefault();

            if (event.deltaY < 0) {
              zoomIn(); // Cu·ªôn l√™n = zoom in
            } else {
              zoomOut(); // Cu·ªôn xu·ªëng = tr·ªü v·ªÅ v·ªã tr√≠ m·∫∑c ƒë·ªãnh
            }
          },
          { passive: false }
        );

        // Mobile zoom controls (ƒë√£ t·∫Øt hi·ªÉn th·ªã)
        // if (window.innerWidth <= 768) {
        //   const zoomControls = document.getElementById("zoomControls");
        //   const zoomInBtn = document.getElementById("zoomIn");
        //   const zoomOutBtn = document.getElementById("zoomOut");
        //   const zoomResetBtn = document.getElementById("zoomReset");

        //   if (zoomControls) {
        //     zoomControls.style.display = "flex";

        //     zoomInBtn.addEventListener("click", zoomIn);
        //     zoomOutBtn.addEventListener("click", zoomOut);
        //     zoomResetBtn.addEventListener("click", resetZoom);
        //   }
        // }

        // Touch pinch zoom for mobile - ch·ªâ zoom in
        let initialDistance = 0;
        let initialFOV = currentFOV;

        document.addEventListener("touchstart", function (event) {
          if (event.touches.length === 2) {
            initialDistance = getDistance(event.touches[0], event.touches[1]);
            initialFOV = currentFOV;
          }
        });

        document.addEventListener(
          "touchmove",
          function (event) {
            if (event.touches.length === 2) {
              event.preventDefault();
              const currentDistance = getDistance(
                event.touches[0],
                event.touches[1]
              );
              const scale = currentDistance / initialDistance;

              // Cho ph√©p zoom in v√† zoom out m∆∞·ª£t m√†
              const newFOV = initialFOV / scale;
              setFOV(newFOV);
            }
          },
          { passive: false }
        );
      }

      function zoomIn() {
        const newFOV = Math.max(minFOV, currentFOV - 10);
        setFOV(newFOV);
      }

      function zoomOut() {
        // Zoom out m∆∞·ª£t m√† thay v√¨ nh·∫£y v·ªÅ m·∫∑c ƒë·ªãnh
        const newFOV = Math.min(defaultFOV, currentFOV + 10);
        setFOV(newFOV);
      }

      function resetZoom() {
        setFOV(defaultFOV); // Reset v·ªÅ v·ªã tr√≠ m·∫∑c ƒë·ªãnh
      }

      function setFOV(fov) {
        currentFOV = Math.max(minFOV, Math.min(defaultFOV, fov));
        const camera = document.querySelector("[camera]");

        if (camera && camera.components && camera.components.camera) {
          camera.components.camera.camera.fov = currentFOV;
          camera.components.camera.camera.updateProjectionMatrix();
        }
      }

      function getDistance(touch1, touch2) {
        const dx = touch1.clientX - touch2.clientX;
        const dy = touch1.clientY - touch2.clientY;
        return Math.sqrt(dx * dx + dy * dy);
      }

      // Register custom zoom component
      AFRAME.registerComponent("zoom-control", {
        init: function () {
          this.el.setAttribute("camera", "fov", currentFOV);
        },
      });

      // Function to switch to main page
      function switchToMainPage() {
        window.location.href = "index.html";
      }
    </script>
  </body>
</html>
